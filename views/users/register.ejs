<% layout('/layouts/boilerplate') -%>

<div class="expense-form-container">
    <h2>Create an Account</h2>
    <form id="registerForm" action="/user/register" method="POST" class="needs-validation" novalidate>
        
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" class="form-control" id="username" name="username" required>
            <div class="invalid-feedback">Please enter a username.</div>
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" name="email" required>
            <div class="invalid-feedback">Please enter a valid email.</div>
        </div>

        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" name="password" required>
            <div class="invalid-feedback">Please enter a password.</div>
        </div>

        <div class="form-group">
            <label for="confirmPassword">Confirm Password:</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
            <div class="invalid-feedback">Passwords do not match.</div>
        </div>

        <button type="submit" class="btn btn-primary">Register</button>
    </form>
</div>

<script>
    // JavaScript for preventing submission on invalid form
    (function () {
        'use strict';
        document.getElementById('registerForm').addEventListener('submit', function (event) {
            // Check if password and confirm password match
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                event.preventDefault(); // Prevent form submission
                event.stopPropagation(); // Stop event bubbling
                document.getElementById('confirmPassword').setCustomValidity('Passwords do not match');
            } else {
                document.getElementById('confirmPassword').setCustomValidity(''); // Clear custom validity
            }

            if (!this.checkValidity()) {
                event.preventDefault();  // Stop form submission
                event.stopPropagation(); // Stop event bubbling
            }
            this.classList.add('was-validated'); // Show validation styling
        }, false);
    })();
</script>
